# Hyperlane Cosmos Module SDK

The Hyperlane Cosmos Module SDK is a fully typed TypeScript SDK for the [Cosmos Hyperlane Module Implementation](https://github.com/bcp-innovations/hyperlane-cosmos).
It can be used as a standalone SDK for frontend or in backend applications which want to connect to a Cosmos SDK chain which has the Hyperlane Module installed.

## Install

```bash
# Install with NPM
npm install @hyperlane-xyz/cosmos-sdk

# Or with Yarn
yarn add @hyperlane-xyz/cosmos-sdk
```

## Usage

```ts
import { HyperlaneModuleClient, SigningHyperlaneModuleClient } from "@hyperlane-xyz/cosmos-sdk";
import { DirectSecp256k1Wallet } from '@cosmjs/proto-signing';

// using hyperlane queries without needing signers
const lightClient = await HyperlaneModuleClient.connect(
  "https://rpc-endpoint:26657"
);

const mailboxes = await lightClient.query.core.Mailboxes();
const bridgedSupply = await lightClient.query.warp.BridgedSupply({ id: "token-id" });
...

// performing hyperlane transactions
const wallet = await DirectSecp256k1Wallet.fromKey(PRIV_KEY);

const signingClient = await SigningHyperlaneModuleClient.connectWithSigner(
  "https://rpc-endpoint:26657",
  wallet,
);

const txReceipt = await signingClient.createMailbox({
  owner: '...',
  local_domain: '...',
  default_ism: '...',
  default_hook: '...',
  required_hook: '...',
})

await signingClient.remoteTransfer({
  sender: '...',
  token_id: '...',
  destination_domain: '...',
  recipient: '...',
  amount: '...',
  ...
})

// sign and broadcast custom messages
await signingClient.signAndBroadcast(signer.getAccounts()[0], [txs...])
```

## Project Structure

The Cosmos SDK project is mainly structured around two important directories. One is autogenerated and enables
encoding/decoding of protobuf transactions while the other one provides the business logic.

### `src/types`

This directory only contains autogenerated code (more on how to autogenerate this below). This directory gets
autogenerated by `ts_proto`, a tool with which protobuf types from the Hyperlane Cosmos Module can be compiled
to TypeScript types and protobuf encoders/decoders which are important for submitting transactions to a Cosmos based
chain. Therefore those files should not be edited and are by default excluded from testing and linting.

### `src/client`

This directory contains all the client SDK logic. For Cosmos chains the default TypeScript SDK provider is the
stargate client. For this hyperlane TypeScript SDK the stargate client was extended to include all the Hyperlane
specific queries and transactions for the Hyperlane Cosmos SDK module.

The basic stargate client called `HyperlaneModuleClient` extends the `StargateClient` class and enables the user
to call all the Hyperlane specific queries. Account balances and other basic queries like the cosmos block height
and simulating gas costs can also be retrieved.

For signing and broadcasting transactions the `SigningHyperlaneModuleClient` extends the `SigningStargateClient` class
and has all the functionality of the `HyperlaneModuleClient` class in addition of being able to sign transactions
and broadcast them to the cosmos chain. In theory you can sign every transaction with this but the user needs to encode
his transactions in the right way, in cosmos transactions are usually encoded with protobuf. All the Hyperlane specific
transactions are registered in the transaction registry in `src/client/registry/index.ts` and can be encoded and decoded
from there. This is possible by using the autogenerated encoders from the types directory.

Looking into the `src/client/hyperlane` directory the following modules can be found: `core`, `interchain_security`, `post_dispatch`
and `warp` which represent the submodules on the chain module. Inside of each submodule the same implementations can be found.
Under `messages.ts` the transaction types are defined while under `aminomessages.ts` the amino converters can be found. Finally
under `query.ts` all the queries of the submodules are registered.

## Contribute

First you need to install the dependencies by running `yarn install`.

### Generating TS Types

You can automatically generate the TypeScript types from the proto files of the Cosmos Hyperlane Module by executing the following commands. Note that this only needs to be done if the proto files change in the Cosmos Hyperlane Module project.

```bash
cd proto
docker compose up
```

After this command has finished the newly generated types can be found under `src/types`.

### Building the project

You can build the project with `yarn build`, the build output can be found under `dist`.

## License

Apache 2.0
